<template>
    <div class="app-grid" :class="{ 'landing-layout': isLandingPage }">
        <!-- 侧边栏 - 只在非LandingPage显示 -->
        <nav v-if="!isLandingPage" class="sidebar">
            <ul class="nav-list">
                <!-- 我的主页 -->
                <li class="nav-item" id="nav-logo" :class="{ active: currentRoute === '/home' }"
                    @click="setActiveLink('/home')">
                    <RouterLink replace :to="{ path: '/home' }">
                        <div class="icon">
                            <div class="image-box">
                                <img src="../public/头像.png" alt="My Home">
                            </div>
                        </div>
                    </RouterLink>
                </li>

                <li v-for="item in navItems" :key="item.path" class="nav-item"
                    :class="{ active: currentRoute === item.path }" @click="setActiveLink(item.path)">
                    <RouterLink replace :to="{ path: item.path }">
                        <div class="icon" v-html="item.svg"></div>
                    </RouterLink>
                </li>
                <hr>

                <label class="theme-switch">
                    <span class="sun" v-if="!isDarkMode">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <g fill="#4f6f57">
                                <circle r="5" cy="12" cx="12"></circle>
                                <path
                                    d="m21 13h-1a1 1 0 0 1 0-2h1a1 1 0 0 1 0 2zm-17 0h-1a1 1 0 0 1 0-2h1a1 1 0 0 1 0 2zm13.66-5.66a1 1 0 0 1 -.66-.29 1 1 0 0 1 0-1.41l.71-.71a1 1 0 1 1 1.41 1.41l-.71.71a1 1 0 0 1 -.75.29zm-12.02 12.02a1 1 0 0 1 -.71-.29 1 1 0 0 1 0-1.41l.71-.66a1 1 0 0 1 1.41 1.41l-.71.71a1 1 0 0 1 -.7.24zm6.36-14.36a1 1 0 0 1 -1-1v-1a1 1 0 0 1 2 0v1a1 1 0 0 1 -1 1zm0 17a1 1 0 0 1 -1-1v-1a1 1 0 0 1 2 0v1a1 1 0 0 1 -1 1zm-5.66-14.66a1 1 0 0 1 -.7-.29l-.71-.71a1 1 0 0 1 1.41-1.41l.71.71a1 1 0 0 1 0 1.41 1 1 0 0 1 -.71.29zm12.02 12.02a1 1 0 0 1 -.7-.29l-.66-.71a1 1 0 0 1 1.36-1.36l.71.71a1 1 0 0 1 0 1.41 1 1 0 0 1 -.71.24z">
                                </path>
                            </g>
                        </svg>
                    </span>

                    <span class="moon" v-if="isDarkMode">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
                            <g fill="#fafff9">
                                <path
                                    d="m223.5 32c-123.5 0-223.5 100.3-223.5 224s100 224 223.5 224c60.6 0 115.5-24.2 155.8-63.4 5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-19.8 2.6-30.1 2.6-96.9 0-175.5-78.8-175.5-176 0-65.8 36-123.1 89.3-153.3 6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z">
                                </path>
                            </g>
                        </svg>
                    </span>

                    <input type="checkbox" class="theme-input" v-model="isDarkMode">
                </label>
            </ul>
        </nav>

        <!-- 主内容区域 -->
        <main class="main-content">
            <RouterView></RouterView>
        </main>
    </div>
</template>

<script lang="ts" setup name="App">
import { RouterView, RouterLink, useRoute } from 'vue-router';
import { ref, watch, onMounted, computed } from 'vue';
import type { svg } from 'd3';

// 定义当前路由路径
const route = useRoute();
const currentRoute = ref(route.path);

// 计算是否为LandingPage
const isLandingPage = computed(() => {
    return route.path === '/';
});

// 定义导航项数据
const navItems = [
    { path: '/bot', text: '创建新的聊天', svg: '<svg t="1753499693704" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="19879" width="30" height="30"><path d="M512 981.33H85.34c-15.85 0-30.38-8.77-37.77-22.81a42.624 42.624 0 0 1 2.6-44.02L135 791.08C75.25 710.5 42.67 612.6 42.67 512 42.67 253.21 253.21 42.67 512 42.67S981.34 253.21 981.34 512 770.8 981.33 512 981.33zM166.44 896H512c211.73 0 384-172.27 384-384S723.73 128 512 128 128 300.27 128 512c0 91.29 32.83 179.9 92.46 249.46 12.58 14.69 13.73 36 2.77 51.94L166.44 896z" fill="#9db39a" p-id="19880"></path><path d="M384 448m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#9db39a" p-id="19881"></path><path d="M640 448m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#9db39a" p-id="19882"></path></svg>' },
    { path: '/graph', text: '文献图谱', svg: '<svg t="1753499300423" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8416" width="30" height="30"><path d="M1009.371429 672.914286l-160.914286-95.085715c-14.628571-7.314286-21.942857-7.314286-36.571429 0l-43.885714 21.942858L658.285714 416.914286l51.2-29.257143c14.628571-7.314286 14.628571-21.942857 14.628572-29.257143V146.285714c0-14.628571-7.314286-21.942857-14.628572-29.257143L526.628571 7.314286h-36.571428L307.2 117.028571c-14.628571 7.314286-21.942857 14.628571-21.942857 29.257143v212.114286c0 14.628571 7.314286 21.942857 14.628571 29.257143l65.828572 36.571428-117.028572 175.542858-36.571428-21.942858c-14.628571-7.314286-21.942857-7.314286-36.571429 0L21.942857 672.914286c-14.628571 7.314286-21.942857 21.942857-21.942857 29.257143v182.857142c0 14.628571 7.314286 21.942857 14.628571 29.257143l160.914286 87.771429c7.314286 0 14.628571 7.314286 14.628572 7.314286s14.628571 0 14.628571-7.314286L365.714286 914.285714c14.628571-7.314286 14.628571-21.942857 14.628571-29.257143V702.171429c0-14.628571-7.314286-21.942857-14.628571-29.257143l-51.2-36.571429L438.857143 460.8l58.514286 29.257143c7.314286 0 14.628571 7.314286 14.628571 7.314286s14.628571 0 14.628571-7.314286l65.828572-36.571429 109.714286 190.171429-51.2 29.257143c-7.314286 7.314286-14.628571 21.942857-14.628572 29.257143v182.857142c0 14.628571 7.314286 21.942857 14.628572 29.257143l160.914285 87.771429c7.314286 0 14.628571 7.314286 14.628572 7.314286s14.628571 0 14.628571-7.314286l160.914286-87.771429c14.628571-7.314286 14.628571-21.942857 14.628571-29.257143V702.171429c7.314286-7.314286 0-21.942857-7.314285-29.257143z m-694.857143 190.171428l-124.342857 73.142857-124.342858-73.142857V724.114286l124.342858-73.142857 124.342857 73.142857v138.971428z m190.171428-438.857143l-146.285714-80.457142V168.228571l146.285714-80.457142 146.285715 80.457142v168.228572l-146.285715 87.771428z m446.171429 438.857143l-124.342857 73.142857-124.342857-73.142857V724.114286l124.342857-73.142857 124.342857 73.142857v138.971428z" fill="#9db39a" p-id="8417"></path></svg>' },
    { path: '/history', text: '历史记录', svg: '<svg t="1753499634467" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16760" width="30" height="30"><path d="M858.624 170.496H165.376c-17.92 0-32.256-14.336-32.256-31.744V32.256C133.12 14.336 147.456 0 165.376 0h693.248c17.92 0 32.256 14.336 32.256 32.256v106.496c0 17.408-14.336 31.744-32.256 31.744zM197.12 106.496h629.248v-42.496H197.12v42.496zM858.624 1024H165.376c-17.92 0-32.256-14.336-32.256-32.256v-106.496c0-17.92 14.336-32.256 32.256-32.256h693.248c17.92 0 32.256 14.336 32.256 32.256v106.496c0 17.92-14.336 32.256-32.256 32.256zM197.12 960h629.248v-42.496H197.12v42.496z" fill="#9db39a" p-id="16761"></path><path d="M192 919.552c-18.944 0-34.304-15.36-34.304-34.304 0-178.176 62.464-289.28 212.992-367.104C216.576 438.272 157.696 332.8 157.696 151.552a34.304 34.304 0 0 1 68.608 0c0 177.664 60.416 262.144 240.128 335.36 12.8 5.12 21.504 17.92 21.504 31.744s-8.704 26.624-21.504 31.744C291.84 619.52 226.816 710.144 226.816 885.248c-0.512 18.944-15.872 34.304-34.816 34.304zM832 919.552c-18.944 0-34.304-15.36-34.304-34.304 0-175.104-65.024-266.24-239.616-334.848-12.8-5.12-21.504-17.92-21.504-31.744s8.192-26.624 21.504-31.744c179.2-73.216 240.128-157.696 240.128-335.36a34.304 34.304 0 0 1 68.608 0c0 181.248-58.88 286.72-212.992 366.592 150.016 78.336 212.992 188.928 212.992 367.104-0.512 18.944-15.872 34.304-34.816 34.304z" fill="#9db39a" p-id="16762"></path><path d="M512 589.824c-18.432 15.872-48.128 35.328-72.192 50.688-66.048 41.984-119.808 87.04-119.808 167.424h384c0-81.408-61.44-124.416-133.12-174.592-15.872-10.752-37.888-26.112-58.88-43.52zM512 458.752c7.68-4.608 16.896-9.216 25.6-14.848 23.552-15.36 42.496-32.256 42.496-61.952H444.416c0 30.208 21.504 46.08 47.104 64.512 5.12 3.584 12.8 7.168 20.48 12.288z" fill="#9db39a" p-id="16763"></path></svg>' },
    { path: '/about', text: '关于我们', svg: '<svg t="1753499507335" class="icon" viewBox="0 0 1407 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="12167" width="30" height="30"><path d="M1353.553825 511.792495h-125.564231a26.938036 26.938036 0 1 0 0 53.821095H1236.950614V610.748544h108.851654v-44.860076h7.751557a26.938036 26.938036 0 1 0 0-53.821095zM1236.950614 968.639588a54.425827 54.425827 0 0 0 108.851654 0v-304.344827H1236.950614zM1030.627252 565.61359h16.492674V660.226568l-27.157938 39.802322h172.018599V600.852939a71.798111 71.798111 0 0 1-35.84408-62.177384 70.588648 70.588648 0 0 1 5.497558-26.88306h-131.006813a26.938036 26.938036 0 0 0 0 53.821095zM1192.090538 753.959937h-208.907214l-113.799457 166.795918a62.012457 62.012457 0 0 0 47.279001 102.30956h291.810394a98.406293 98.406293 0 0 1-16.492675-54.425827zM1392.366587 920.755855l-1.704243-2.528876v50.412609a98.956049 98.956049 0 0 1-10.225459 43.430711 62.067433 62.067433 0 0 0 11.929702-91.314444z" fill="#9db39a" p-id="12168"></path><path d="M847.558561 904.153229l120.506477-176.526596 50.467585-73.887183a577.24362 577.24362 0 0 0-287.797176-185.377666 259.539727 259.539727 0 1 0-308.248093 0A576.74884 576.74884 0 0 0 0 1024h852.891192a91.094541 91.094541 0 0 1-17.482235-25.453695 88.675615 88.675615 0 0 1 12.149604-94.393076z" fill="#9db39a" p-id="12169"></path><path d="M1030.627252 484.304703H1083.018982c-13.523993-5.057754-27.487791-9.565751-41.341638-13.469018a224.465305 224.465305 0 0 0-133.42574-405.11507c-5.057754 0-10.005556 0.439805-14.953358 0.769659a258.715093 258.715093 0 0 1-18.306869 401.87151A577.24362 577.24362 0 0 1 984.062933 511.077812a54.2609 54.2609 0 0 1 46.564319-26.773109z" p-id="12170"></path></svg>' },

];

// 监听路由变化，更新当前激活的导航项
watch(() => route.path, (newPath) => {
    currentRoute.value = newPath;
});

// 点击导航项时设置当前激活的导航项
function setActiveLink(path: string) {
    currentRoute.value = path;
}

// 主题切换逻辑
const isDarkMode = ref(localStorage.getItem('theme') === 'dark');

// 监听主题切换
watch(isDarkMode, (newVal) => {
    if (newVal) {
        document.body.classList.add('dark-theme');
        localStorage.setItem('theme', 'dark');
    } else {
        document.body.classList.remove('dark-theme');
        localStorage.setItem('theme', 'light');
    }
});

// 初始化主题
onMounted(() => {
    if (isDarkMode.value) {
        document.body.classList.add('dark-theme');
    }
});
</script>

<style>
@import url("../src/assets/styles/App.css");
</style>
